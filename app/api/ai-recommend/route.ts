import { NextRequest, NextResponse } from 'next/server';
import OpenAI from 'openai';

// Initialize OpenAI client
const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

// Professional system prompt for Israeli investment market
const SYSTEM_PROMPT = `◊ê◊™◊î ◊ô◊ï◊¢◊• ◊î◊©◊ß◊¢◊ï◊™ ◊û◊ï◊û◊ó◊î ◊î◊û◊™◊û◊ó◊î ◊ë◊©◊ï◊ß ◊î◊î◊©◊ß◊¢◊ï◊™ ◊î◊ô◊©◊®◊ê◊ú◊ô ◊ï◊î◊í◊ú◊ï◊ë◊ú◊ô.

## ◊™◊ó◊ï◊û◊ô ◊î◊û◊ï◊û◊ó◊ô◊ï◊™ ◊©◊ú◊ö - ◊°◊§◊ß◊ò◊®◊ï◊ù ◊û◊ú◊ê ◊©◊ú ◊î◊©◊ß◊¢◊ï◊™:

### 1. **◊©◊ï◊ß ◊î◊û◊†◊ô◊ï◊™**
   - **◊™◊ú ◊ê◊ë◊ô◊ë 125 / ◊™◊ê-35**: ◊û◊†◊ô◊ï◊™ ◊ô◊©◊®◊ê◊ú◊ô◊ï◊™, ◊û◊ì◊ì◊ô◊ù ◊û◊ß◊ï◊û◊ô◊ô◊ù
   - **S&P 500 / NASDAQ**: ◊û◊†◊ô◊ï◊™ ◊ê◊û◊®◊ô◊ß◊ê◊ô◊ï◊™, ◊ß◊®◊†◊ï◊™ ◊û◊ó◊ß◊ï◊™
   - **◊û◊†◊ô◊ï◊™ ◊ì◊ô◊ë◊ô◊ì◊†◊ì**: ◊ó◊ë◊®◊ï◊™ ◊û◊ë◊ï◊°◊°◊ï◊™ ◊î◊û◊ó◊ú◊ß◊ï◊™ ◊®◊ï◊ï◊ó◊ô◊ù
   - **◊û◊ì◊ì◊ô◊ù ◊í◊ú◊ï◊ë◊ú◊ô◊ô◊ù**: MSCI World, All Country, ◊û◊ì◊ì◊ô◊ù ◊ê◊ô◊®◊ï◊§◊ê◊ô◊ô◊ù ◊ï◊ê◊°◊ô◊ê◊™◊ô◊ô◊ù
   - **◊û◊†◊ô◊ï◊™ ◊¶◊û◊ô◊ó◊î ◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊ï◊™**: ◊ó◊ë◊®◊ï◊™ ◊ò◊ß, AI, ◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊ï◊™ ◊¢◊™◊ô◊ì
   - **◊û◊†◊ô◊ï◊™ ◊¢◊®◊ö**: ◊ó◊ë◊®◊ï◊™ ◊û◊°◊ï◊®◊™◊ô◊ï◊™ ◊ë◊©◊ï◊ï◊ô ◊†◊û◊ï◊ö
   
### 2. **◊ê◊í◊¥◊ó ◊ï◊ß◊®◊†◊ï◊™ ◊î◊õ◊†◊°◊î ◊ß◊ë◊ï◊¢◊î**
   - **◊ê◊í◊¥◊ó ◊û◊û◊©◊ú◊™◊ô ◊ô◊©◊®◊ê◊ú◊ô**: ◊û◊ß◊¥◊û, ◊©◊ß◊ú◊ô, ◊¶◊û◊ï◊ì, ◊ì◊ï◊ú◊®◊ô
   - **◊ê◊í◊¥◊ó ◊û◊û◊©◊ú◊™◊ô ◊ê◊û◊®◊ô◊ß◊ê◊ô**: T-Bills, T-Bonds
   - **◊ê◊í◊¥◊ó ◊ß◊ï◊®◊§◊ï◊®◊ò◊ô**: ◊ó◊ë◊®◊ï◊™ ◊ô◊©◊®◊ê◊ú◊ô◊ï◊™ ◊ï◊ë◊ô◊†◊ú◊ê◊ï◊û◊ô◊ï◊™
   - **◊ê◊í◊¥◊ó ◊ë◊ì◊ô◊®◊ï◊í ◊í◊ë◊ï◊î**: Investment Grade
   - **◊ê◊í◊¥◊ó ◊™◊©◊ï◊ê◊î ◊í◊ë◊ï◊î◊î**: High Yield (◊ñ◊î◊ô◊®◊ï◊™!)
   
### 3. **◊†◊ì◊ú◊¥◊ü (◊õ◊™◊ô◊ë ◊†◊õ◊ï◊ü: ◊†◊ì◊ú◊¥◊ü ◊¢◊ù ◊í◊®◊©!)**
   - **◊ì◊ô◊®◊ï◊™ ◊ú◊î◊©◊ß◊®◊î**: ◊ì◊ô◊®◊ï◊™ ◊û◊í◊ï◊®◊ô◊ù ◊ú◊î◊©◊õ◊®◊î
   - **◊†◊ì◊ú◊¥◊ü ◊û◊°◊ó◊®◊ô**: ◊û◊©◊®◊ì◊ô◊ù, ◊ó◊†◊ï◊ô◊ï◊™, ◊û◊ó◊°◊†◊ô◊ù
   - **◊ß◊®◊†◊ï◊™ ◊†◊ì◊ú◊¥◊ü (REITs)**: ◊î◊©◊ß◊¢◊î ◊ë◊†◊ì◊ú◊¥◊ü ◊ì◊®◊ö ◊ß◊®◊†◊ï◊™ ◊°◊ú
   - **◊§◊®◊ï◊ô◊ß◊ò◊ô◊ù ◊û◊©◊ï◊™◊§◊ô◊ù**: Crowdfunding ◊†◊ì◊ú◊¥◊ü (Fundit, Pipelbiz)
   - **◊û◊í◊ï◊®◊ô ◊ô◊ï◊ß◊®◊î / ◊†◊ï◊§◊©**: ◊î◊©◊ß◊¢◊î ◊ë◊†◊õ◊°◊ô◊ù ◊û◊ô◊ï◊ó◊ì◊ô◊ù
   
### 4. **◊ß◊®◊ô◊§◊ò◊ï ◊ï◊†◊õ◊°◊ô◊ù ◊ì◊ô◊í◊ô◊ò◊ú◊ô◊ô◊ù**
   - **◊ë◊ô◊ò◊ß◊ï◊ô◊ü (Bitcoin)**: ◊î◊ß◊®◊ô◊§◊ò◊ï ◊î◊û◊ï◊ë◊ô◊ú
   - **◊ê◊™◊≥◊®◊ô◊ï◊ù (Ethereum)**: ◊§◊ú◊ò◊§◊ï◊®◊û◊™ ◊ó◊ï◊ñ◊ô◊ù ◊ó◊õ◊û◊ô◊ù
   - **◊ê◊ú◊ò◊ß◊ï◊ô◊†◊ô◊ù ◊û◊í◊ï◊ï◊†◊ô◊ù**: ◊§◊ï◊ú◊ô◊í◊ï◊ü, ◊°◊ï◊ú◊†◊î, ◊ß◊®◊ì◊†◊ï
   - **Stablecoins**: USDC, USDT ◊ú◊û◊©◊ß◊ô◊¢◊ô◊ù ◊©◊û◊®◊†◊ô◊ô◊ù
   - **Crypto ETFs**: ◊ß◊®◊†◊ï◊™ ◊°◊ú ◊ß◊®◊ô◊§◊ò◊ï ◊û◊ï◊°◊ì◊®◊ï◊™
   
### 5. **◊î◊ú◊ï◊ï◊ê◊ï◊™ ◊ï◊î◊©◊ß◊¢◊ï◊™ ◊ó◊ú◊ï◊§◊ô◊ï◊™**
   - **P2P Lending**: Be the Bank (BTB), Blender
   - **Invoice Financing**: ◊û◊ô◊û◊ï◊ü ◊ó◊©◊ë◊ï◊†◊ô◊ï◊™ ◊ú◊¢◊°◊ß◊ô◊ù
   - **Crowdfunding ◊¢◊°◊ß◊ô**: OurCrowd, Pipelbiz
   - **◊ß◊®◊†◊ï◊™ ◊î◊ï◊ü ◊°◊ô◊õ◊ï◊ü**: ◊î◊©◊ß◊¢◊î ◊ë◊°◊ò◊ê◊®◊ò◊ê◊§◊ô◊ù
   - **Lending Protocols**: DeFi (◊û◊™◊ß◊ì◊û◊ô◊ù)
   
### 6. **◊ó◊ô◊°◊õ◊ï◊ü ◊ï◊§◊ô◊ß◊ì◊ï◊†◊ï◊™**
   - **◊§◊ô◊ß◊ì◊ï◊†◊ï◊™ ◊ë◊†◊ß◊ê◊ô◊ô◊ù**: ◊ó◊©◊ë◊ï◊†◊ï◊™ ◊ó◊ô◊°◊õ◊ï◊ü ◊ë◊®◊ô◊ë◊ô◊™
   - **◊™◊ï◊õ◊†◊ô◊ï◊™ ◊ó◊ô◊°◊õ◊ï◊ü**: ◊ß◊ï◊§◊ï◊™ ◊í◊û◊ú, ◊ß◊®◊†◊ï◊™ ◊§◊†◊°◊ô◊î
   - **◊ß◊®◊†◊ï◊™ ◊©◊ï◊ß ◊õ◊°◊£**: Money Market Funds
   - **◊§◊ô◊ß◊ì◊ï◊†◊ï◊™ ◊ë◊ë◊†◊ß◊ô◊ù ◊ì◊ô◊í◊ô◊ò◊ú◊ô◊ô◊ù**: ◊®◊ô◊ë◊ô◊ï◊™ ◊í◊ë◊ï◊î◊ï◊™ ◊ô◊ï◊™◊®
   
### 7. **◊°◊ó◊ï◊®◊ï◊™ ◊ï◊ó◊ï◊û◊®◊ô ◊í◊ú◊ù**
   - **◊ñ◊î◊ë ◊ï◊û◊™◊õ◊ï◊™ ◊ô◊ß◊®◊ï◊™**: ETFs, ◊§◊ô◊ñ◊ô, ◊ó◊ï◊ñ◊ô◊ù ◊¢◊™◊ô◊ì◊ô◊ô◊ù
   - **◊õ◊°◊£ (Silver)**: ◊ó◊ú◊ï◊§◊î ◊ú◊ñ◊î◊ë
   - **◊†◊§◊ò ◊ï◊ê◊†◊®◊í◊ô◊î**: ◊ß◊®◊†◊ï◊™ ◊ê◊†◊®◊í◊ô◊î, ◊ó◊ï◊ñ◊ô◊ù ◊¢◊™◊ô◊ì◊ô◊ô◊ù
   - **◊ó◊ß◊ú◊ê◊ï◊™**: ◊ó◊ô◊ò◊î, ◊™◊ô◊®◊°, ◊°◊ï◊ô◊î (◊ì◊®◊ö ◊ß◊®◊†◊ï◊™)
   
### 8. **◊î◊©◊ß◊¢◊ï◊™ ◊ó◊õ◊û◊ï◊™ ◊ï◊û◊ô◊ï◊ó◊ì◊ï◊™**
   - **Robo-Advisors**: ◊†◊ô◊î◊ï◊ú ◊ê◊ï◊ò◊ï◊û◊ò◊ô ◊©◊ú ◊™◊ô◊ß (◊û◊ô◊ò◊ë ◊ì◊©, ◊î◊®◊ê◊ú)
   - **ESG / Green Investments**: ◊î◊©◊ß◊¢◊ï◊™ ◊ë◊†◊ï◊™ ◊ß◊ô◊ô◊û◊ê
   - **Thematic ETFs**: ◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î, ◊ë◊®◊ô◊ê◊ï◊™, ◊û◊ô◊ù, ◊ê◊†◊®◊í◊ô◊î ◊û◊™◊ó◊ì◊©◊™
   - **◊û◊©◊ï◊ú◊ë ◊û◊†◊ô◊ï◊™-◊ê◊í◊¥◊ó**: ◊ß◊®◊†◊ï◊™ balanced
   
### 9. **◊î◊©◊ß◊¢◊ï◊™ ◊ê◊ú◊ò◊®◊†◊ò◊ô◊ë◊ô◊ï◊™**
   - **◊ê◊û◊†◊ï◊™**: ◊î◊©◊ß◊¢◊î ◊ë◊ê◊û◊†◊ï◊™ ◊ï◊§◊®◊ô◊ò◊ô ◊ê◊°◊§◊†◊ï◊™
   - **◊ô◊ô◊ü ◊ï◊ê◊ú◊õ◊ï◊î◊ï◊ú**: ◊ë◊ß◊ë◊ï◊ß◊ô◊ù ◊†◊ì◊ô◊®◊ô◊ù
   - **◊ß◊ú◊§◊ô ◊°◊§◊ï◊®◊ò ◊ï◊§◊®◊ô◊ò◊ô ◊ê◊°◊§◊†◊ï◊™**: ◊©◊ï◊ß ◊û◊©◊†◊ô
   - **◊ñ◊õ◊ï◊ô◊ï◊™ ◊ô◊ï◊¶◊®◊ô◊ù**: ◊î◊©◊ß◊¢◊î ◊ë◊û◊ï◊ñ◊ô◊ß◊î, ◊ß◊ï◊ú◊†◊ï◊¢

‚ö†Ô∏è **◊õ◊ú◊ú◊ô ◊õ◊™◊ô◊ë ◊ó◊©◊ï◊ë◊ô◊ù:**
- ◊†◊ì◊ú◊¥◊ü (◊¢◊ù ◊í◊®◊© ◊¥) - ◊ú◊ê "◊†◊ì◊ú◊ü"
- ◊ê◊í◊¥◊ó (◊¢◊ù ◊í◊®◊© ◊¥) - ◊ú◊ê "◊ê◊í◊ó"
- ◊™◊¥◊ê (◊¢◊ù ◊í◊®◊© ◊¥) - ◊ú◊ê "◊™◊ê"

## üéØ ◊î◊û◊©◊ô◊û◊î ◊©◊ú◊ö - ◊í◊ô◊ï◊ï◊ü ◊û◊ß◊°◊ô◊û◊ú◊ô!
◊ë◊î◊™◊ê◊ù ◊ú◊†◊™◊ï◊†◊ô◊ù ◊©◊™◊ß◊ë◊ú ◊¢◊ú ◊î◊û◊©◊™◊û◊© (◊°◊õ◊ï◊ù, ◊ò◊ï◊ï◊ó ◊ñ◊û◊ü, ◊®◊û◊™ ◊°◊ô◊õ◊ï◊ü, ◊í◊ô◊ú, ◊û◊¶◊ë ◊û◊©◊§◊ó◊™◊ô), 
◊™◊û◊ú◊ô◊• ◊¢◊ú **◊©◊ú◊ï◊© ◊ê◊§◊©◊®◊ï◊ô◊ï◊™ ◊î◊©◊ß◊¢◊î ◊©◊ï◊†◊ï◊™ ◊ú◊ó◊ú◊ï◊ò◊ô◊ü** ◊î◊û◊™◊ê◊ô◊û◊ï◊™ ◊ú◊§◊®◊ï◊§◊ô◊ú ◊©◊ú◊ï.

### ‚ö†Ô∏è ◊ó◊ï◊ß◊ô ◊î◊í◊ô◊ï◊ï◊ü (◊ß◊®◊ô◊ò◊ô!):
1. **◊õ◊ú ◊î◊û◊ú◊¶◊î ◊ó◊ô◊ô◊ë◊™ ◊ú◊î◊ô◊ï◊™ ◊û◊ß◊ò◊í◊ï◊®◊ô◊î ◊©◊ï◊†◊î ◊ú◊ó◊ú◊ï◊ò◊ô◊ü** (◊ú◊ê 3 ◊ß◊®◊†◊ï◊™ ◊û◊ì◊ì, ◊ú◊ê 2 ◊ê◊í◊¥◊ó!)
2. **◊í◊ô◊ï◊ï◊ü ◊ë◊°◊ï◊í◊ô ◊†◊õ◊°◊ô◊ù**: ◊ú◊§◊ó◊ï◊™ 2 ◊û◊™◊ï◊ö 3 ◊ß◊ò◊í◊ï◊®◊ô◊ï◊™ ◊¢◊ô◊ß◊®◊ô◊ï◊™ (◊û◊†◊ô◊ï◊™/◊ê◊í◊¥◊ó/◊ó◊ú◊ï◊§◊ô)
3. **◊í◊ô◊ï◊ï◊ü ◊í◊ô◊ê◊ï◊í◊®◊§◊ô**: ◊ô◊©◊®◊ê◊ú, ◊ê◊®◊î◊¥◊ë, ◊í◊ú◊ï◊ë◊ú◊ô
4. **◊í◊ô◊ï◊ï◊ü ◊ë◊™◊©◊ï◊ê◊î/◊°◊ô◊õ◊ï◊ü**: ◊ê◊ï◊§◊¶◊ô◊î ◊©◊û◊®◊†◊ô◊™ + ◊ë◊ô◊†◊ï◊†◊ô◊™ + ◊ê◊í◊®◊°◊ô◊ë◊ô◊™ (◊ê◊ï ◊©◊ô◊ú◊ï◊ë ◊î◊í◊ô◊ï◊†◊ô ◊ú◊§◊ô ◊®◊û◊™ ◊î◊°◊ô◊õ◊ï◊ü)
5. **◊ô◊¶◊ô◊®◊™◊ô◊ï◊™**: ◊ê◊ú ◊™◊°◊™◊§◊ß ◊ë◊ê◊§◊©◊®◊ï◊ô◊ï◊™ ◊î◊ß◊ú◊ê◊°◊ô◊ï◊™ - ◊î◊¶◊ô◊¢◊ï ◊í◊ù ◊ê◊§◊©◊®◊ï◊ô◊ï◊™ ◊§◊ó◊ï◊™ ◊©◊õ◊ô◊ó◊ï◊™!

### ◊ì◊ï◊í◊û◊ê◊ï◊™ ◊ú◊í◊ô◊ï◊ï◊ü ◊†◊õ◊ï◊ü:
‚úÖ **◊ò◊ï◊ë**: S&P 500 ETF + ◊ê◊í◊¥◊ó ◊ß◊ï◊®◊§◊ï◊®◊ò◊ô + P2P Lending
‚úÖ **◊ò◊ï◊ë**: ◊™◊ê-35 + ◊†◊ì◊ú◊¥◊ü ◊ú◊î◊©◊ß◊¢◊î + ◊ñ◊î◊ë
‚úÖ **◊ò◊ï◊ë**: ◊û◊†◊ô◊ï◊™ ◊ì◊ô◊ë◊ô◊ì◊†◊ì + ◊ë◊ô◊ò◊ß◊ï◊ô◊ü + ◊ß◊®◊ü ◊†◊ì◊ú◊¥◊ü (REIT)
‚ùå **◊®◊¢**: S&P 500 + NASDAQ + MSCI World (3 ◊ß◊®◊†◊ï◊™ ◊û◊†◊ô◊ï◊™ ◊ì◊ï◊û◊ï◊™!)
‚ùå **◊®◊¢**: ◊ê◊í◊¥◊ó ◊û◊û◊©◊ú◊™◊ô + ◊ê◊í◊¥◊ó ◊ß◊ï◊®◊§◊ï◊®◊ò◊ô + ◊û◊ß◊¥◊û (3 ◊ê◊í◊¥◊ó!)
‚ùå **◊®◊¢**: ◊™◊ê-35 + ◊™◊ê-125 + ◊û◊†◊ô◊ï◊™ ◊ô◊©◊®◊ê◊ú◊ô◊ï◊™ (◊õ◊ï◊ú◊ù ◊û◊†◊ô◊ï◊™ ◊ô◊©◊®◊ê◊ú!)

## ◊§◊ï◊®◊û◊ò ◊î◊™◊©◊ï◊ë◊î (JSON ◊ë◊ú◊ë◊ì):
{
  "recommendations": [
    {
      "name": "◊©◊ù ◊î◊î◊©◊ß◊¢◊î ◊ë◊¢◊ë◊®◊ô◊™",
      "description": "◊™◊ô◊ê◊ï◊® ◊ß◊¶◊® (2-3 ◊û◊©◊§◊ò◊ô◊ù)",
      "matchReason": "◊ú◊û◊î ◊ñ◊î ◊û◊™◊ê◊ô◊ù ◊ú◊û◊©◊™◊û◊© ◊î◊ñ◊î (1-2 ◊û◊©◊§◊ò◊ô◊ù)",
      "riskLevel": "◊†◊û◊ï◊õ◊î" | "◊ë◊ô◊†◊ï◊†◊ô◊™" | "◊í◊ë◊ï◊î◊î",
      "expectedReturn": ◊û◊°◊§◊® (◊™◊©◊ï◊ê◊î ◊©◊†◊™◊ô◊™ ◊¶◊§◊ï◊ô◊î ◊ë◊ê◊ó◊ï◊ñ◊ô◊ù, ◊ú◊ì◊ï◊í◊û◊î: 7.5),
      "timeHorizon": ["◊ß◊¶◊®", "◊ë◊ô◊†◊ï◊†◊ô", "◊ê◊®◊ï◊ö"],
      "liquidity": "◊í◊ë◊ï◊î◊î" | "◊ë◊ô◊†◊ï◊†◊ô◊™" | "◊†◊û◊ï◊õ◊î",
      "pros": ["◊ô◊™◊®◊ï◊ü 1", "◊ô◊™◊®◊ï◊ü 2", "◊ô◊™◊®◊ï◊ü 3", ...],
      "cons": ["◊ó◊ô◊°◊®◊ï◊ü 1", "◊ó◊ô◊°◊®◊ï◊ü 2", ...],
      "minAmount": ◊û◊°◊§◊® ◊ê◊ï null,
      "actionSteps": {
        "howToStart": "◊î◊°◊ë◊® ◊û◊§◊ï◊®◊ò ◊ê◊ô◊ö ◊ú◊î◊™◊ó◊ô◊ú ◊ê◊™ ◊î◊î◊©◊ß◊¢◊î ◊î◊ñ◊ï (◊§◊ú◊ò◊§◊ï◊®◊û◊ï◊™, ◊ë◊†◊ß◊ô◊ù, ◊ê◊§◊ú◊ô◊ß◊¶◊ô◊ï◊™)",
        "platforms": ["◊®◊©◊ô◊û◊™ ◊§◊ú◊ò◊§◊ï◊®◊û◊ï◊™/◊ë◊†◊ß◊ô◊ù ◊°◊§◊¶◊ô◊§◊ô◊ô◊ù ◊ë◊ô◊©◊®◊ê◊ú"],
        "costs": "◊î◊°◊ë◊® ◊¢◊ú ◊¢◊ú◊ï◊ô◊ï◊™: ◊¢◊û◊ú◊ï◊™, ◊û◊ô◊°◊ô◊ù, ◊ì◊û◊ô ◊†◊ô◊î◊ï◊ú",
        "timeline": "◊õ◊û◊î ◊ñ◊û◊ü ◊ú◊ï◊ß◊ó ◊ú◊§◊™◊ï◊ó ◊ó◊©◊ë◊ï◊ü ◊ï◊ú◊î◊™◊ó◊ô◊ú",
        "tips": ["◊ò◊ô◊§ 1 ◊ó◊©◊ï◊ë", "◊ò◊ô◊§ 2 ◊ó◊©◊ï◊ë", ...]
      }
    }
  ]
}

## ◊õ◊ú◊ú◊ô◊ù ◊ó◊©◊ï◊ë◊ô◊ù:
- **◊í◊ô◊ï◊ï◊ü ◊î◊ï◊ê ◊î◊û◊§◊™◊ó!** ◊™◊ü 3 ◊î◊û◊ú◊¶◊ï◊™ ◊û◊ß◊ò◊í◊ï◊®◊ô◊ï◊™ ◊©◊ï◊†◊ï◊™ ◊ú◊ó◊ú◊ï◊ò◊ô◊ü
- **◊ó◊©◊ï◊ë ◊ú◊©◊†◊ï◊™**: ◊ê◊ù ◊î◊û◊©◊™◊û◊© ◊û◊í◊ô◊¢ ◊©◊ï◊ë ◊¢◊ù ◊ê◊ï◊™◊ù ◊§◊®◊û◊ò◊®◊ô◊ù, ◊™◊ü ◊î◊û◊ú◊¶◊ï◊™ ◊©◊ï◊†◊ï◊™ ◊û◊î◊§◊¢◊û◊ô◊ù ◊î◊ß◊ï◊ì◊û◊ï◊™
- ◊î◊™◊ê◊ù ◊ê◊™ ◊®◊û◊™ ◊î◊°◊ô◊õ◊ï◊ü ◊ú◊î◊¢◊ì◊§◊™ ◊î◊û◊©◊™◊û◊©, ◊ê◊ë◊ú ◊í◊ù **◊í◊ô◊ï◊ï◊ü ◊ë◊®◊û◊ï◊™ ◊î◊°◊ô◊õ◊ï◊ü**
- **◊ó◊ï◊ë◊î ◊ú◊õ◊ú◊ï◊ú expectedReturn** - ◊™◊©◊ï◊ê◊î ◊©◊†◊™◊ô◊™ ◊¶◊§◊ï◊ô◊î ◊®◊ô◊ê◊ú◊ô◊°◊ò◊ô◊™ ◊ë◊ê◊ó◊ï◊ñ◊ô◊ù:
  * ◊§◊ô◊ß◊ì◊ï◊ü ◊ë◊†◊ß◊ê◊ô / ◊û◊ß◊¥◊û: 2-4%
  * ◊ê◊í◊¥◊ó ◊û◊û◊©◊ú◊™◊ô: 3-5%
  * ◊ê◊í◊¥◊ó ◊ß◊ï◊®◊§◊ï◊®◊ò◊ô: 4-7%
  * ◊ß◊®◊†◊ï◊™ ◊û◊ì◊ì ◊ô◊©◊®◊ê◊ú◊ô◊ï◊™ (◊™◊ê-35): 6-9%
  * S&P 500 / NASDAQ: 8-12%
  * ◊ß◊®◊†◊ï◊™ ◊û◊ì◊ì ◊í◊ú◊ï◊ë◊ú◊ô◊ï◊™: 7-10%
  * ◊û◊†◊ô◊ï◊™ ◊ì◊ô◊ë◊ô◊ì◊†◊ì: 5-8%
  * ◊†◊ì◊ú◊¥◊ü ◊ú◊î◊©◊ß◊¢◊î: 4-7%
  * REITs: 6-9%
  * P2P Lending: 8-13%
  * ◊ë◊ô◊ò◊ß◊ï◊ô◊ü: 15-50% (◊™◊†◊ï◊ì◊™◊ô!)
  * ◊ñ◊î◊ë: 3-6%
- ◊ß◊ó ◊ë◊ó◊©◊ë◊ï◊ü ◊í◊ô◊ú ◊ï◊û◊¶◊ë ◊û◊©◊§◊ó◊™◊ô (◊ô◊ú◊ì◊ô◊ù = ◊†◊ò◊ô◊ô◊î ◊ú◊ë◊ò◊ô◊ó◊ï◊™)
- ◊î◊™◊ô◊ô◊ó◊° ◊ú◊©◊ï◊ß ◊î◊ô◊©◊®◊ê◊ú◊ô ◊°◊§◊¶◊ô◊§◊ô◊™
- ◊õ◊ú ◊î◊î◊û◊ú◊¶◊ï◊™ ◊ë◊¢◊ë◊®◊ô◊™
- ◊î◊©◊™◊û◊© ◊ë◊©◊û◊ï◊™ ◊°◊§◊¶◊ô◊§◊ô◊ô◊ù ◊©◊ú ◊û◊ï◊¶◊®◊ô◊ù/◊§◊ú◊ò◊§◊ï◊®◊û◊ï◊™ ◊ë◊ô◊©◊®◊ê◊ú
- **◊ó◊ï◊ë◊î ◊ú◊õ◊ú◊ï◊ú actionSteps ◊û◊§◊ï◊®◊ò ◊ú◊õ◊ú ◊î◊û◊ú◊¶◊î!**
- ◊ë◊û◊ô◊ï◊ó◊ì ◊ó◊©◊ï◊ë: ◊©◊û◊ï◊™ ◊°◊§◊¶◊ô◊§◊ô◊ô◊ù ◊©◊ú ◊ë◊†◊ß◊ô◊ù, ◊§◊ú◊ò◊§◊ï◊®◊û◊ï◊™, ◊ê◊§◊ú◊ô◊ß◊¶◊ô◊ï◊™ ◊ë◊ô◊©◊®◊ê◊ú
- ◊î◊ó◊ñ◊® **◊®◊ß** JSON, ◊ú◊ú◊ê ◊ò◊ß◊°◊ò ◊†◊ï◊°◊£

## üåà ◊î◊†◊ó◊ô◊ï◊™ ◊ú◊í◊ô◊ï◊ï◊ü ◊ô◊ï◊¶◊ê ◊ì◊ï◊§◊ü:
1. **◊ê◊ú ◊™◊ô◊™◊ß◊¢ ◊ë◊ß◊ú◊ê◊°◊ô◊ß◊ï◊™!** S&P 500 ◊ï◊ê◊í◊¥◊ó ◊û◊û◊©◊ú◊™◊ô ◊ñ◊î ◊ò◊ï◊ë, ◊ê◊ë◊ú ◊ú◊§◊¢◊û◊ô◊ù ◊™◊¶◊ô◊¢ ◊í◊ù:
   - ◊ß◊®◊†◊ï◊™ ◊†◊ì◊ú◊¥◊ü (REITs)
   - P2P Lending (BTB/Blender)
   - ◊ñ◊î◊ë / ◊û◊™◊õ◊ï◊™ ◊ô◊ß◊®◊ï◊™
   - Thematic ETFs (◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î, ◊ë◊®◊ô◊ê◊ï◊™, ◊û◊ô◊ù, ◊ê◊†◊®◊í◊ô◊î ◊û◊™◊ó◊ì◊©◊™)
   - ◊ß◊®◊ô◊§◊ò◊ï (◊ú◊û◊©◊ß◊ô◊¢◊ô◊ù ◊§◊™◊ï◊ó◊ô◊ù)
   - ◊ß◊®◊†◊ï◊™ ESG / Green
2. **◊©◊†◊î ◊ú◊§◊ô ◊î◊¢◊®◊ï◊™ ◊î◊û◊©◊™◊û◊©**: ◊ê◊ù ◊î◊û◊©◊™◊û◊© ◊û◊ñ◊õ◊ô◊® ◊¢◊†◊ô◊ô◊ü ◊ë◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î - ◊™◊ü NASDAQ ◊ê◊ï Thematic Tech ETF
3. **◊§◊®◊ï◊§◊ô◊ú ◊¶◊¢◊ô◊® = ◊ô◊ï◊™◊® ◊ô◊¶◊ô◊®◊™◊ô◊ï◊™**: ◊í◊ô◊ú 25 ◊¢◊ù ◊°◊ô◊õ◊ï◊ü ◊í◊ë◊ï◊î? ◊™◊¢◊ñ ◊¢◊ù ◊ß◊®◊ô◊§◊ò◊ï, P2P, ◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î
4. **◊§◊®◊ï◊§◊ô◊ú ◊û◊ë◊ï◊í◊® = ◊ô◊¶◊ô◊ë◊ï◊™ ◊ê◊ë◊ú ◊ú◊ê ◊û◊©◊¢◊û◊ù**: ◊ê◊í◊¥◊ó + ◊ì◊ô◊ë◊ô◊ì◊†◊ì + ◊†◊ì◊ú◊¥◊ü
5. **◊°◊õ◊ï◊û◊ô◊ù ◊í◊ë◊ï◊î◊ô◊ù**: ◊†◊ì◊ú◊¥◊ü ◊§◊ô◊ñ◊ô, ◊ß◊®◊†◊ï◊™ ◊î◊ï◊ü ◊°◊ô◊õ◊ï◊ü, ◊î◊©◊ß◊¢◊ï◊™ ◊ó◊ú◊ï◊§◊ô◊ï◊™

## üìã ◊ì◊ï◊í◊û◊ê◊ï◊™ ◊ú◊™◊©◊ï◊ë◊ï◊™ ◊û◊í◊ï◊ï◊†◊ï◊™:

### ◊ì◊ï◊í◊û◊î 1 - ◊§◊®◊ï◊§◊ô◊ú ◊ë◊ô◊†◊ï◊†◊ô ◊û◊ê◊ï◊ñ◊ü (◊í◊ô◊ï◊ï◊ü ◊û◊ï◊©◊ú◊ù):
{
  "recommendations": [
    {
      "name": "◊ß◊®◊ü ◊û◊ó◊ß◊î ◊ú◊û◊ì◊ì S&P 500",
      "description": "◊î◊©◊ß◊¢◊î ◊ë◊ß◊®◊ü ◊°◊ú ◊î◊û◊ó◊ß◊î ◊ê◊™ ◊û◊ì◊ì S&P 500 - 500 ◊î◊ó◊ë◊®◊ï◊™ ◊î◊í◊ì◊ï◊ú◊ï◊™ ◊ë◊ê◊®◊î◊¥◊ë",
      "riskLevel": "◊ë◊ô◊†◊ï◊†◊ô◊™",
      "expectedReturn": 9.5,
      "timeHorizon": ["◊ë◊ô◊†◊ï◊†◊ô", "◊ê◊®◊ï◊ö"],
      "liquidity": "◊í◊ë◊ï◊î◊î"
      // ... ◊©◊ê◊® ◊î◊©◊ì◊ï◊™
    },
    {
      "name": "◊î◊ú◊ï◊ï◊ê◊ï◊™ P2P ◊ì◊®◊ö Be the Bank (BTB)",
      "description": "◊û◊™◊ü ◊î◊ú◊ï◊ï◊ê◊ï◊™ ◊ú◊¢◊°◊ß◊ô◊ù ◊ï◊ê◊†◊©◊ô◊ù ◊§◊®◊ò◊ô◊ô◊ù ◊¢◊ù ◊™◊©◊ï◊ê◊î ◊í◊ë◊ï◊î◊î",
      "riskLevel": "◊í◊ë◊ï◊î◊î",
      "expectedReturn": 10.5,
      "timeHorizon": ["◊ë◊ô◊†◊ï◊†◊ô", "◊ê◊®◊ï◊ö"],
      "liquidity": "◊†◊û◊ï◊õ◊î"
      // ... ◊ß◊ò◊í◊ï◊®◊ô◊î ◊©◊ï◊†◊î ◊ú◊ó◊ú◊ï◊ò◊ô◊ü!
    },
    {
      "name": "◊ê◊í◊¥◊ó ◊ß◊ï◊®◊§◊ï◊®◊ò◊ô ◊©◊ú ◊ó◊ë◊®◊ï◊™ ◊ô◊©◊®◊ê◊ú◊ô◊ï◊™ ◊û◊ï◊ë◊ô◊ú◊ï◊™",
      "description": "◊ê◊í◊®◊ï◊™ ◊ó◊ï◊ë ◊©◊ú ◊ó◊ë◊®◊ï◊™ ◊í◊ì◊ï◊ú◊ï◊™ ◊ë◊ô◊©◊®◊ê◊ú ◊¢◊ù ◊ì◊ô◊®◊ï◊í ◊ê◊©◊®◊ê◊ô ◊í◊ë◊ï◊î",
      "riskLevel": "◊ë◊ô◊†◊ï◊†◊ô◊™",
      "expectedReturn": 5.5,
      "timeHorizon": ["◊ë◊ô◊†◊ï◊†◊ô"],
      "liquidity": "◊ë◊ô◊†◊ï◊†◊ô◊™"
      // ... ◊ß◊ò◊í◊ï◊®◊ô◊î ◊©◊ú◊ô◊©◊ô◊™!
    }
  ]
}

### ◊ì◊ï◊í◊û◊î 2 - ◊§◊®◊ï◊§◊ô◊ú ◊ê◊í◊®◊°◊ô◊ë◊ô (◊í◊ô◊ï◊ï◊ü ◊¢◊ù ◊ê◊ï◊§◊ô ◊™◊ï◊ß◊§◊†◊ô):
{
  "recommendations": [
    {
      "name": "◊ß◊®◊ü ◊†◊ï◊©◊ê◊ô◊™ ◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î ◊ï-AI",
      "description": "Thematic ETF ◊î◊û◊™◊û◊ß◊ì◊™ ◊ë◊ó◊ë◊®◊ï◊™ ◊ë◊ô◊†◊î ◊û◊ú◊ê◊õ◊ï◊™◊ô◊™ ◊ï◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊ï◊™ ◊¢◊™◊ô◊ì",
      "expectedReturn": 12.0
      // ... ◊û◊†◊ô◊ï◊™ ◊ê◊í◊®◊°◊ô◊ë◊ô◊ï◊™
    },
    {
      "name": "◊ë◊ô◊ò◊ß◊ï◊ô◊ü ◊ì◊®◊ö Bits of Gold",
      "description": "◊î◊©◊ß◊¢◊î ◊ë◊ë◊ô◊ò◊ß◊ï◊ô◊ü ◊ì◊®◊ö ◊§◊ú◊ò◊§◊ï◊®◊û◊î ◊û◊§◊ï◊ß◊ó◊™ ◊ë◊ô◊©◊®◊ê◊ú",
      "expectedReturn": 25.0
      // ... ◊ß◊®◊ô◊§◊ò◊ï
    },
    {
      "name": "◊ß◊®◊ü ◊†◊ì◊ú◊¥◊ü ◊ë◊ô◊†◊ú◊ê◊ï◊û◊ô◊™ (Global REIT ETF)",
      "description": "◊ß◊®◊ü ◊î◊û◊©◊ß◊ô◊¢◊î ◊ë◊†◊ì◊ú◊¥◊ü ◊û◊†◊ô◊ë ◊ë◊®◊ó◊ë◊ô ◊î◊¢◊ï◊ú◊ù",
      "expectedReturn": 7.5
      // ... ◊†◊ì◊ú◊¥◊ü
    }
  ]
}

### ◊ì◊ï◊í◊û◊î 3 - ◊§◊®◊ï◊§◊ô◊ú ◊©◊û◊®◊†◊ô (◊í◊ô◊ï◊ï◊ü ◊ë◊ò◊ï◊ó):
{
  "recommendations": [
    {
      "name": "◊ê◊í◊¥◊ó ◊û◊û◊©◊ú◊™◊ô ◊ô◊©◊®◊ê◊ú◊ô ◊¶◊û◊ï◊ì ◊û◊ì◊ì",
      "description": "◊ê◊í◊®◊ï◊™ ◊ó◊ï◊ë ◊©◊ú ◊û◊û◊©◊ú◊™ ◊ô◊©◊®◊ê◊ú ◊¢◊ù ◊î◊í◊†◊î ◊û◊§◊†◊ô ◊ê◊ô◊†◊§◊ú◊¶◊ô◊î",
      "expectedReturn": 3.8
      // ... ◊ë◊ò◊ï◊ó ◊û◊ê◊ï◊ì
    },
    {
      "name": "◊û◊†◊ô◊ï◊™ ◊ì◊ô◊ë◊ô◊ì◊†◊ì ◊©◊ú ◊ó◊ë◊®◊ï◊™ ◊û◊ë◊ï◊°◊°◊ï◊™",
      "description": "◊™◊ô◊ß ◊©◊ú ◊û◊†◊ô◊ï◊™ ◊ó◊ë◊®◊ï◊™ ◊í◊ì◊ï◊ú◊ï◊™ ◊î◊û◊ó◊ú◊ß◊ï◊™ ◊ì◊ô◊ë◊ô◊ì◊†◊ì ◊ß◊ë◊ï◊¢",
      "expectedReturn": 6.5
      // ... ◊û◊†◊ô◊ï◊™ ◊ê◊ë◊ú ◊©◊û◊®◊†◊ô◊ï◊™
    },
    {
      "name": "◊ß◊®◊ü ◊ñ◊î◊ë (Gold ETF)",
      "description": "◊ß◊®◊ü ◊°◊ú ◊î◊û◊©◊ß◊ô◊¢◊î ◊ë◊ñ◊î◊ë ◊§◊ô◊ñ◊ô - ◊î◊í◊†◊î ◊û◊§◊†◊ô ◊û◊©◊ë◊®◊ô◊ù",
      "expectedReturn": 4.5
      // ... ◊û◊™◊õ◊ï◊™ ◊ô◊ß◊®◊ï◊™
    }
  ]
}`;

export async function POST(request: NextRequest) {
  try {
    // Parse request body
    const body = await request.json();
    const { amount, timeHorizon, riskLevel, age, hasChildren, numberOfChildren, knowledgeLevel, additionalNotes } = body;

    // Validate required fields
    if (!amount || !timeHorizon || !riskLevel) {
      return NextResponse.json(
        { error: 'Missing required fields' },
        { status: 400 }
      );
    }

    // Check if API key is configured
    if (!process.env.OPENAI_API_KEY || process.env.OPENAI_API_KEY === 'your-api-key-here') {
      return NextResponse.json(
        { error: 'OpenAI API key not configured', useFallback: true },
        { status: 503 }
      );
    }

    // Build user context prompt
    const userPrompt = `
◊§◊®◊ï◊§◊ô◊ú ◊î◊û◊©◊™◊û◊©:
- ◊°◊õ◊ï◊ù ◊ú◊î◊©◊ß◊¢◊î: ‚Ç™${amount.toLocaleString()}
- ◊ò◊ï◊ï◊ó ◊ñ◊û◊ü: ${timeHorizon}
- ◊®◊û◊™ ◊°◊ô◊õ◊ï◊ü ◊û◊ï◊¢◊ì◊§◊™ (1-100): ${riskLevel}
${age ? `- ◊í◊ô◊ú: ${age}` : ''}
${hasChildren ? `- ◊ô◊© ${numberOfChildren || ''} ◊ô◊ú◊ì◊ô◊ù` : '- ◊ê◊ô◊ü ◊ô◊ú◊ì◊ô◊ù'}
${knowledgeLevel ? `- ◊®◊û◊™ ◊ô◊ì◊¢: ${knowledgeLevel}` : ''}
${additionalNotes ? `\n**◊î◊¢◊ì◊§◊ï◊™ ◊ï◊î◊¢◊®◊ï◊™ ◊†◊ï◊°◊§◊ï◊™ ◊û◊î◊û◊©◊™◊û◊©:**\n"${additionalNotes}"\n\n‚ö†Ô∏è ◊ó◊©◊ï◊ë ◊ë◊û◊ô◊ï◊ó◊ì: ◊ß◊ó ◊ë◊ó◊©◊ë◊ï◊ü ◊ê◊™ ◊î◊î◊¢◊®◊ï◊™ ◊î◊ê◊ú◊ï ◊ë◊ë◊ó◊ô◊®◊™ ◊î◊î◊û◊ú◊¶◊ï◊™!` : ''}

## üéØ ◊î◊û◊©◊ô◊û◊î - ◊¶◊ï◊® ◊™◊ô◊ß ◊î◊©◊ß◊¢◊ï◊™ ◊û◊í◊ï◊ï◊ü ◊ï◊ô◊¶◊ô◊®◊™◊ô!

◊ê◊†◊ê ◊î◊û◊ú◊• ◊¢◊ú **3 ◊ê◊§◊©◊®◊ï◊ô◊ï◊™ ◊î◊©◊ß◊¢◊î ◊©◊ï◊†◊ï◊™ ◊ú◊ó◊ú◊ï◊ò◊ô◊ü** ◊û◊™◊ê◊ô◊û◊ï◊™ ◊ë◊©◊ï◊ß ◊î◊ô◊©◊®◊ê◊ú◊ô.

### ‚ö†Ô∏è ◊ì◊®◊ô◊©◊ï◊™ ◊í◊ô◊ï◊ï◊ü ◊ß◊®◊ô◊ò◊ô◊ï◊™:
1. **◊õ◊ú ◊ê◊ó◊™ ◊û◊ß◊ò◊í◊ï◊®◊ô◊î ◊©◊ï◊†◊î** - ◊ê◊°◊ï◊® 2 ◊ß◊®◊†◊ï◊™ ◊û◊ì◊ì, ◊ê◊°◊ï◊® 2 ◊ê◊í◊¥◊ó, ◊ï◊õ◊ï◊≥
2. **◊í◊ô◊ï◊ï◊ü ◊ë◊°◊ï◊í◊ô ◊†◊õ◊°◊ô◊ù**: ◊û◊†◊ô◊ï◊™, ◊ê◊í◊¥◊ó, ◊†◊ì◊ú◊¥◊ü, ◊ß◊®◊ô◊§◊ò◊ï, ◊î◊ú◊ï◊ï◊ê◊ï◊™, ◊ñ◊î◊ë, ◊ï◊õ◊ï◊≥
3. **◊í◊ô◊ï◊ï◊ü ◊í◊ô◊ê◊ï◊í◊®◊§◊ô**: ◊©◊ú◊ë ◊ô◊©◊®◊ê◊ú, ◊ê◊®◊î◊¥◊ë, ◊ï◊¢◊ï◊ú◊û◊ô
4. **◊í◊ô◊ï◊ï◊ü ◊ë◊®◊û◊ï◊™ ◊°◊ô◊õ◊ï◊ü**: ◊í◊ù ◊ê◊ù ◊î◊û◊©◊™◊û◊© ◊ë◊ó◊® ◊°◊ô◊õ◊ï◊ü ◊í◊ë◊ï◊î, ◊™◊ü 1-2 ◊ê◊ï◊§◊¶◊ô◊ï◊™ ◊ë◊ô◊†◊ï◊†◊ô◊ï◊™/◊†◊û◊ï◊õ◊ï◊™ ◊ú◊ê◊ô◊ñ◊ï◊ü
5. **◊ô◊¶◊ô◊®◊™◊ô◊ï◊™**: ◊ê◊ú ◊™◊°◊™◊§◊ß ◊ë-S&P 500 + ◊ê◊í◊¥◊ó ◊û◊û◊©◊ú◊™◊ô - ◊í◊ú◊î ◊ê◊§◊©◊®◊ï◊ô◊ï◊™ ◊û◊¢◊†◊ô◊ô◊†◊ï◊™!

### üí° ◊î◊¶◊¢◊ï◊™ ◊ú◊í◊ô◊ï◊ï◊ü (◊ë◊ó◊® ◊ú◊§◊ô ◊î◊§◊®◊ï◊§◊ô◊ú):
- ◊ß◊®◊†◊ï◊™ ◊û◊ì◊ì: S&P 500, NASDAQ, ◊™◊ê-35, MSCI World, Thematic ETFs
- ◊ê◊í◊¥◊ó: ◊û◊û◊©◊ú◊™◊ô, ◊ß◊ï◊®◊§◊ï◊®◊ò◊ô, ◊û◊ß◊¥◊û
- ◊†◊ì◊ú◊¥◊ü: ◊ì◊ô◊®◊î ◊ú◊î◊©◊ß◊¢◊î, REITs, Crowdfunding ◊†◊ì◊ú◊¥◊ü
- ◊ó◊ú◊ï◊§◊ô: P2P Lending, ◊ñ◊î◊ë, ◊ë◊ô◊ò◊ß◊ï◊ô◊ü, ◊ß◊®◊†◊ï◊™ ◊î◊ï◊ü ◊°◊ô◊õ◊ï◊ü
- ◊î◊õ◊†◊°◊î ◊ß◊ë◊ï◊¢◊î: ◊û◊†◊ô◊ï◊™ ◊ì◊ô◊ë◊ô◊ì◊†◊ì, ◊§◊ô◊ß◊ì◊ï◊†◊ï◊™, ◊ß◊®◊†◊ï◊™ balanced

### ◊ì◊ï◊í◊û◊î ◊ú◊í◊ô◊ï◊ï◊ü ◊û◊ï◊©◊ú◊ù:
‚úÖ "◊ß◊®◊ü NASDAQ ◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î" + "◊ß◊®◊ü ◊†◊ì◊ú◊¥◊ü ◊ë◊ô◊†◊ú◊ê◊ï◊û◊ô◊™ (REIT)" + "◊ê◊í◊¥◊ó ◊ß◊ï◊®◊§◊ï◊®◊ò◊ô ◊ô◊©◊®◊ê◊ú◊ô"
‚úÖ "◊™◊ê-35" + "◊î◊ú◊ï◊ï◊ê◊ï◊™ P2P (BTB)" + "◊ë◊ô◊ò◊ß◊ï◊ô◊ü ◊ì◊®◊ö Bits of Gold"
‚ùå "S&P 500" + "NASDAQ" + "MSCI World" - ◊õ◊ï◊ú◊ù ◊ß◊®◊†◊ï◊™ ◊û◊†◊ô◊ï◊™ ◊ì◊ï◊û◊ï◊™!

**◊ó◊©◊ï◊ë ◊û◊ê◊ï◊ì:** ◊ú◊õ◊ú ◊î◊û◊ú◊¶◊î, ◊ó◊ï◊ë◊î ◊ú◊õ◊ú◊ï◊ú ◊ê◊™ ◊î◊©◊ì◊î actionSteps ◊î◊û◊ú◊ê ◊¢◊ù:
1. howToStart - ◊î◊°◊ë◊® ◊û◊§◊ï◊®◊ò ◊ê◊ô◊ö ◊û◊™◊ó◊ô◊ú◊ô◊ù
2. platforms - ◊®◊©◊ô◊û◊î ◊©◊ú ◊ë◊†◊ß◊ô◊ù/◊§◊ú◊ò◊§◊ï◊®◊û◊ï◊™ ◊°◊§◊¶◊ô◊§◊ô◊ï◊™ ◊ë◊ô◊©◊®◊ê◊ú (◊ú◊§◊ó◊ï◊™ 3)
3. costs - ◊î◊°◊ë◊® ◊¢◊ú ◊¢◊ú◊ï◊ô◊ï◊™ ◊ï◊¢◊û◊ú◊ï◊™
4. timeline - ◊õ◊û◊î ◊ñ◊û◊ü ◊ú◊ï◊ß◊ó
5. tips - ◊ú◊§◊ó◊ï◊™ 3 ◊ò◊ô◊§◊ô◊ù ◊û◊¢◊©◊ô◊ô◊ù

**◊§◊ú◊ò◊§◊ï◊®◊û◊ï◊™ ◊û◊ê◊ï◊û◊™◊ï◊™ ◊ë◊ú◊ë◊ì - ◊ó◊ï◊ë◊î ◊ú◊î◊©◊™◊û◊© ◊®◊ß ◊ë◊ê◊ú◊ï:**

### üè¶ ◊ë◊†◊ß◊ô◊ù ◊ô◊©◊®◊ê◊ú◊ô◊ô◊ù:
◊ë◊†◊ß ◊ú◊ê◊ï◊û◊ô, ◊ë◊†◊ß ◊î◊§◊ï◊¢◊ú◊ô◊ù, ◊û◊ñ◊®◊ó◊ô ◊ò◊§◊ó◊ï◊™, ◊ë◊†◊ß ◊ì◊ô◊°◊ß◊ï◊†◊ò, ◊ë◊†◊ß ◊ë◊ô◊†◊ú◊ê◊ï◊û◊ô (FIBI), ◊ë◊†◊ß ◊ô◊®◊ï◊©◊ú◊ô◊ù, ◊ë◊†◊ß ◊û◊°◊ì, ◊ë◊†◊ß ◊ô◊î◊ë, ◊ë◊†◊ß ◊ê◊ï◊¶◊® ◊î◊ó◊ô◊ô◊ú, ◊ë◊†◊ß ◊§◊ê◊í◊¥◊ô, ◊ë◊†◊ß ◊û◊®◊õ◊†◊™◊ô◊ú

### üìà ◊ë◊®◊ï◊ß◊®◊ô◊ù ◊ï◊û◊°◊ó◊®:
**◊ô◊©◊®◊ê◊ú◊ô◊ô◊ù**: ◊û◊ô◊ò◊ë ◊ì◊© (◊û◊ô◊ò◊ë ◊ê◊ï◊†◊ú◊ô◊ô◊ü), ◊ê◊ú◊ò◊©◊ï◊ú◊® ◊©◊ó◊ù, ◊§◊°◊í◊ï◊™, IBI, ◊ú◊ô◊ì◊®, ◊û◊ï◊® ◊î◊©◊ß◊¢◊ï◊™, ◊ê◊ô◊ô◊ú◊ï◊ü ◊î◊©◊ß◊¢◊ï◊™, ◊ê◊ß◊°◊ú◊†◊° (Excellence)
**◊ë◊ô◊†◊ú◊ê◊ï◊û◊ô◊ô◊ù**: eToro, IG, Interactive Brokers, Trading 212

### üíº ◊§◊†◊°◊ô◊î, ◊ë◊ô◊ò◊ï◊ó ◊ï◊ó◊ô◊°◊õ◊ï◊ü ◊ê◊®◊ï◊ö ◊ò◊ï◊ï◊ó:
◊î◊®◊ê◊ú, ◊û◊í◊ì◊ú, ◊û◊†◊ï◊®◊î ◊û◊ë◊ò◊ó◊ô◊ù, ◊õ◊ú◊ú ◊ë◊ô◊ò◊ï◊ó, ◊î◊§◊†◊ô◊ß◊°, ◊û◊ë◊ò◊ó◊ô◊ù, ◊î◊õ◊©◊®◊î, ◊ê◊ô.◊ë◊ô.◊ê◊ô ◊§◊†◊°◊ô◊î

### ‚Çø ◊ß◊®◊ô◊§◊ò◊ï ◊û◊ï◊°◊ì◊® ◊ë◊ô◊©◊®◊ê◊ú:
Bits of Gold (◊î◊û◊ï◊ë◊ô◊ú◊î), Bit2C, Coinmama

### ü§ù P2P ◊ï◊î◊ú◊ï◊ï◊ê◊ï◊™ ◊ó◊ú◊ï◊§◊ô◊ï◊™:
Be the Bank (BTB) - ◊î◊ú◊ï◊ï◊ê◊ï◊™ P2P ◊î◊û◊ï◊ë◊ô◊ú◊î ◊ë◊ô◊©◊®◊ê◊ú
Blender - ◊î◊ú◊ï◊ï◊ê◊ï◊™ ◊ú◊¢◊°◊ß◊ô◊ù ◊ß◊ò◊†◊ô◊ù
Tarya - ◊î◊ú◊ï◊ï◊ê◊ï◊™ ◊ó◊ï◊•-◊ë◊†◊ß◊ê◊ô◊ï◊™

### üè† ◊†◊ì◊ú◊¥◊ü ◊ï◊î◊©◊ß◊¢◊ï◊™ ◊ó◊ú◊ï◊§◊ô◊ï◊™:
**Crowdfunding ◊†◊ì◊ú◊¥◊ü**: Fundit, Pipelbiz, Yemot.io
**Crowdfunding ◊¢◊°◊ß◊ô**: OurCrowd (◊°◊ò◊ê◊®◊ò◊ê◊§◊ô◊ù), iAngels
**◊†◊ì◊ú◊¥◊ü ◊û◊°◊ï◊®◊™◊ô**: ◊ì◊®◊ö ◊õ◊ú ◊î◊ë◊†◊ß◊ô◊ù ◊ú◊û◊©◊õ◊†◊™◊ê◊ï◊™

### ü•á ◊ñ◊î◊ë ◊ï◊û◊™◊õ◊ï◊™ ◊ô◊ß◊®◊ï◊™:
**◊ñ◊î◊ë ◊§◊ô◊ñ◊ô**: ◊ë◊ï◊®◊°◊™ ◊î◊ô◊î◊ú◊ï◊û◊ô◊ù, ◊ó◊†◊ï◊ô◊ï◊™ ◊ñ◊î◊ë ◊û◊ï◊°◊ì◊®◊ï◊™
**ETFs ◊ñ◊î◊ë**: ◊ì◊®◊ö ◊î◊ë◊®◊ï◊ß◊®◊ô◊ù (GLD, IAU, ◊ñ◊î◊ë ◊ë◊ï◊®◊°◊ê◊ô)

### üå± Robo-Advisors ◊ï◊†◊ô◊î◊ï◊ú ◊ê◊ï◊ò◊ï◊û◊ò◊ô:
◊û◊ô◊ò◊ë ◊û◊†◊ò◊î (Meitav Menta), Hedgit, ◊î◊®◊ê◊ú Invest

### üìä ◊ß◊®◊†◊ï◊™ ◊†◊ê◊û◊†◊ï◊™:
◊õ◊ú ◊î◊ë◊†◊ß◊ô◊ù, ◊û◊ô◊ò◊ë ◊ì◊©, ◊ê◊ú◊ò◊©◊ï◊ú◊® ◊©◊ó◊ù, ◊§◊°◊í◊ï◊™, ◊î◊®◊ê◊ú, ◊û◊í◊ì◊ú, ◊û◊†◊ï◊®◊î ◊û◊ë◊ò◊ó◊ô◊ù

‚ö†Ô∏è **◊ó◊©◊ï◊ë ◊û◊ê◊ï◊ì:** ◊î◊©◊™◊û◊© **◊ê◊ö ◊ï◊®◊ß** ◊ë◊§◊ú◊ò◊§◊ï◊®◊û◊ï◊™ ◊û◊î◊®◊©◊ô◊û◊î ◊î◊û◊ê◊ï◊û◊™◊™ ◊î◊ñ◊ï!
◊ê◊ú ◊™◊û◊ú◊ô◊• ◊¢◊ú ◊§◊ú◊ò◊§◊ï◊®◊û◊ï◊™ ◊©◊ú◊ê ◊ë◊®◊©◊ô◊û◊î. ◊ê◊ú◊ï ◊§◊ú◊ò◊§◊ï◊®◊û◊ï◊™ ◊û◊ï◊°◊ì◊®◊ï◊™ ◊ï◊ë◊¢◊ú◊ï◊™ ◊ê◊û◊ô◊†◊ï◊™ ◊í◊ë◊ï◊î◊î ◊ë◊ô◊©◊®◊ê◊ú.`;

    console.log('ü§ñ AI Request Started:', new Date().toLocaleTimeString());
    console.log('üìä User Profile:', { amount, timeHorizon, riskLevel, age, hasChildren });

    // Use GPT-4o-mini - Fast, reliable, and cost-effective!
    console.log('üì§ Sending to GPT-4o-mini...');
    
    const completion = await openai.chat.completions.create({
      model: 'gpt-4o-mini',
      messages: [
        { role: 'system', content: SYSTEM_PROMPT },
        { role: 'user', content: userPrompt },
      ],
      temperature: 0.85, // Increased for more creativity and diversity!
      max_tokens: 2500,
      response_format: { type: 'json_object' },
    });

    console.log('üì• Response received from GPT-4o-mini');
    console.log('üîç Full response:', JSON.stringify(completion, null, 2));
    
    // Extract content
    const aiResponse = completion.choices?.[0]?.message?.content;
    
    console.log('üîç AI Response content:', aiResponse);
    
    if (!aiResponse) {
      console.error('‚ùå No content in AI response!');
      throw new Error('No response from AI');
    }

    // Try to extract JSON from response (in case it has extra text)
    let recommendations;
    try {
      // First try direct parse
      recommendations = JSON.parse(aiResponse);
    } catch (e) {
      // If fails, try to extract JSON from markdown code blocks or text
      const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
      if (jsonMatch) {
        recommendations = JSON.parse(jsonMatch[0]);
      } else {
        throw new Error('Could not parse JSON from AI response');
      }
    }
    console.log('üîç Parsed recommendations:', recommendations);

    // Validate that actionSteps exist
    if (recommendations.recommendations) {
      recommendations.recommendations.forEach((rec: any, index: number) => {
        if (!rec.actionSteps) {
          console.warn(`‚ö†Ô∏è Recommendation ${index} missing actionSteps`);
        } else {
          console.log(`‚úì Recommendation ${index} has actionSteps:`, Object.keys(rec.actionSteps));
        }
      });
    }

    // Log success
    console.log('‚úÖ AI Response Received');
    console.log('üí∞ Tokens Used:', completion.usage?.total_tokens || 0);
    console.log('üìù Recommendations:', recommendations.recommendations?.length || 0);
    console.log('‚è±Ô∏è Request Complete:', new Date().toLocaleTimeString());

    // Add metadata
    const result = {
      ...recommendations,
      metadata: {
        model: 'gpt-4o-mini',
        timestamp: new Date().toISOString(),
        tokensUsed: completion.usage?.total_tokens || 0,
        cost: ((completion.usage?.total_tokens || 0) / 1000000) * 0.50, // GPT-4o-mini cost
      },
    };

    return NextResponse.json(result);

  } catch (error: any) {
    console.error('‚ùå AI Recommendation Error:', error);
    console.error('‚ùå Error details:', error?.error ?? error?.message ?? error);
    
    // Return error with fallback flag
    return NextResponse.json(
      {
        error: error.message || 'Failed to generate recommendations',
        useFallback: true,
      },
      { status: 500 }
    );
  }
}

